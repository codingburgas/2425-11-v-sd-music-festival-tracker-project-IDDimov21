@using Microsoft.AspNetCore.Components.Authorization
@using FestivalApp_PL.Auth
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager Navigation

<CascadingAuthenticationState>
    <AuthorizeView>
        <Authorized>
            <nav class="sidebar">
                <div class="logo-section">
                    <div class="logo">LOGO</div>
                    <span class="logo-name">LOGO NAME</span>
                </div>

                <div class="profile">
                    <img src="icons/account.png" class="icon" />
                    <span class="profile-name">@UserDisplayName</span>
                </div>

                <ul class="nav-menu">
                    <li>
                        <NavLink class="nav-item" href="/dashboard">
                            <img src="icons/dashboard-icon.png" class="icon" />
                            <span class="text">Dashboard</span>
                        </NavLink>
                    </li>
                    <li>
                        <NavLink class="nav-item active" href="/calendar">
                            <img src="icons/calendar-icon.png" class="icon" />
                            <span class="text">My Calendar</span>
                        </NavLink>
                    </li>
                    <li>
                        <NavLink class="nav-item" href="/tickets">
                            <img src="icons/book-tickets-icon.png" class="icon" />
                            <span class="text">Book Tickets</span>
                        </NavLink>
                    </li>
                </ul>
                
                <div class="settings">
                    <NavLink class="nav-item" href="/settings">
                        <img src="icons/settings-icon.png" class="icon" />
                        <span class="text">Settings</span>
                    </NavLink>
                </div>
                
                <div class="logout">
                    <button class="btn-logout" @onclick="HandleLogout">
                        <img src="icons/logout-icons.png" class="icon" />
                        <span class="text">Logout</span>
                    </button>
                </div>
            </nav>
        </Authorized>
    </AuthorizeView>
</CascadingAuthenticationState>

@code {
    private string UserDisplayName = "User";

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity.IsAuthenticated)
        {
            UserDisplayName = user.Identity.Name ?? "User";
        }
    }

    private async Task HandleLogout()
    {
        await ((CustomAuthStateProvider)AuthStateProvider).Logout();
        Navigation.NavigateTo("/", forceLoad: true);
    }
}
